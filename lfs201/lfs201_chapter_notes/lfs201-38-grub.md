Chapter 38: GRUB
----------------

[38.1: GRUB](#381-grub)  
[38.2: Chapter 38 Introduction](#382-chapter-38-introduction)  
[38.3: Learning Objectives](#383-learning-objectives)  
[38.4: What Is GRUB?](#384-what-is-grub)  
[38.5: Interactive Selections with GRUB at Boot](#385-interactive-selections-with-grub-at-boot)  
[38.6: Installing GRUB](#386-installing-grub)  
[38.7: GRUB Device Nomenclature](#387-grub-device-nomenclature)  
[38.8: GRUB Configuration File](#388-grub-configuration-file)  
[38.9: Using GRUB Demo](#389-using-grub-demo)   
[Lab 38.1: Booting into Non-Graphical Mode Using GRUB](#lab-381-booting-into-non-graphical-mode-using-grub) 
[Paths and Commands](#paths-and-commands)  
  
### 38.3: Learning Objectives
----
By the end of this chapter, you should be able to:
* Explain what the role of GRUB is.
* Understand the differences between the GRUB 1 and GRUB 2 versions.
* Explain the interactive selections you can make at boot.
* Install GRUB.
* Explain how the configuration files that GRUB needs are used and* modified. 
  
### 38.4: What Is GRUB?
----
* virtually all x86-based Linux systems use GRUB (GRand Unified Bootloader) to handle the early phases of system startup
* important features:
    * alternative operating systems can be chosen at boot time
    * alternative kernels and/or initial ramdisks can be chosen at boot time for a given operating system
    * boot parameters can be easily changed at boot time without having to edit configuration files, etc. in advance
* at boot, a basic configuration file is read, either `/boot/grub/grub.cfg` or `/boot/grub2/grub.cfg`, depending on distribution
* this file is auto-generated by **update-grub** (or **grub2-mkconfig** on RHEL 7) based on configuration files in the `/etc/grub.d` directory and on `/etc/default/grub` and should never be edited by hand
    * for either version, the relevant essential configuration file contains some global parameters and then a stanza for each operating system or kernel configured
  
### 38.5: Interactive Selections with GRUB at Boot
----
* can choose bootable images during boot
* can edit the **stanza** (not persistent)
* can enter single user mode (maintenance mode or runlevel 1), which provides as few services as possible and only minimal functionality
  
### 38.6: Installing GRUB
----
* "**installing**" can have several different meanings with respect to GRUB:
    * installing the grub program and associated utilities in their proper locations
    * installing the files GRUB needs to operate at boot time, under either `/boot/grub` or `/boot/grub2`; this is separate than the files the Linux kernel needs (**vmlinuz-\***, **initramfs-\***) which will need to be in the `/boot` directory as well
    * installing GRUB as the boot loader in the system; usually, this is done at the front of the entire hard disk, but can also be done in a partition and accessed via **chainloading** from one GRUB to another
* `$ sudo grub2-install /dev/sda` install GRUB for version 2 (read the **man** first!!)
  
### 38.7: GRUB Device Nomenclature
----
* in both GRUB versions, the first hard drive is denoted as hd0, the second is hd1, etc; however, in Version 1, partitions start counting from 0, and in Version 2 from 1:
    * sda1 is (hd0,1) in GRUB 2, but (hd0,0) in GRUB 1
    * sdc4 is (hd2,4) in GRUB 2, but (hd2,3) in GRUB 1
* the root partition is not the same as the root directory - it's the partition that contains the kernel itself in the `/boot` directory
* it is also fine to do `kernel (hd0,0)/vmlinuz....` instead, and leave out the `root` line
* `grub.cfg` is at `boot/grub2/grub.cfg` on my CentOS 7 VM
  
### 38.8: GRUB Configuration File
----
* 1 `/etc/default/grub` file used to update GRUB configuration, `grub.cfg`
* 2 `/etc/grub.d` directory used to update GRUB configuration, `grub.cfg`
  
### 38.9: Using GRUB Demo
----

### Lab 38.1: Booting into Non-Graphical Mode Using GRUB 
----

### Paths and Commands
----
  
#### Paths  

Topics | Path | Notes | Reference
------ | ---- | ----- | ---------
startup/shutdown | `/boot/grub/grub.cfg` | GRUB configuration file | 38.4
startup/shutdown | `/boot/grub2/grub.cfg` | GRUB configuration file | 38.4
startup/shutdown | `/etc/grub.d` | used by **update-grub** or **grub2-mkconfig** to modify `grub.cfg` | 38.4
startup/shutdown | `/etc/default/grub` | used by **update-grub** or **grub2-mkconfig** to modify `grub.cfg` | 38.4
startup/shutdown | `/boot/grub` or `/boot/grub2` | GRUB files needed at boot time | 38.6
startup/shutdown | `vmlinuz-*` | file needed by the Linux kernel | 38.6
startup/shutdown | `initramfs-*` | file needed by the Linux kernel | 38.6
startup/shutdown | 1 `/etc/default/grub` | file used to update GRUB configuration file `grub.cfg` | 38.8
startup/shutdown | 2 `/etc/grub.d` | directory used to update GRUB configuration file `grub.cfg` | 38.8
  
#### Commands  

Topics | Command | Notes | Reference
------ | ------- | ----- | ---------
startup/shutdown | `$ update-grub ...` or `$ grub2-mkconfig ...` | modify `grub.cfg` | 38.4
startup/shutdown | `$ sudo grub2-install /dev/sda` | install GRUB for version 2 (read the **man** first!!) | 38.6
  